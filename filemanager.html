<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GitHub File Manager</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    ul { list-style-type: none; padding-left: 20px; }
    li { margin: 5px 0; }
    a { text-decoration: none; color: #0366d6; }
    a:hover { text-decoration: underline; }
    .folder { font-weight: bold; cursor: pointer; }
    #breadcrumb a { margin-right: 5px; text-decoration: none; color: #0366d6; }
    #breadcrumb a:hover { text-decoration: underline; }
</style>
</head>
<body>
<h1>GitHub File Manager</h1>
<div>
    <label>Repo (owner/repo): <input id="repoInput" placeholder="username/repo" /></label>
    <label>Branch: <input id="branchInput" value="main" /></label>
    <button onclick="loadRepo()">Load</button>
</div>
<div id="breadcrumb"></div>
<ul id="fileTree"></ul>

<script>
let currentPath = '';

async function fetchFolder(owner, repo, path = '', branch = 'main') {
    // Принудительно начинаем из files/
    const fullPath = path ? `files/${path}` : 'files';
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${fullPath}?ref=${branch}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Error fetching repo');
    return await res.json();
}

function createFileLink(item, owner, repo, branch) {
    const li = document.createElement('li');
    if (item.type === 'dir') {
        li.textContent = '📁 ' + item.name;
        li.classList.add('folder');
        li.onclick = async (e) => {
            e.stopPropagation();
            currentPath = item.path.replace(/^files\//, ''); // убираем files/ из пути
            updateBreadcrumb(owner, repo, branch);
            await showFolder(owner, repo, currentPath, branch);
        }
    } else if (item.type === 'file') {
        const a = document.createElement('a');
        a.textContent = '📄 ' + item.name;
        a.href = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${item.path}`;
        a.target = '_blank';
        li.appendChild(a);
    }
    return li;
}

function updateBreadcrumb(owner, repo, branch) {
    const breadcrumb = document.getElementById('breadcrumb');
    breadcrumb.innerHTML = '';
    const parts = currentPath.split('/').filter(p => p);
    const rootLink = document.createElement('a');
    rootLink.textContent = 'files';
    rootLink.href = '#';
    rootLink.onclick = async () => {
        currentPath = '';
        await showFolder(owner, repo, '', branch);
    }
    breadcrumb.appendChild(rootLink);
    parts.forEach((part, index) => {
        breadcrumb.appendChild(document.createTextNode(' / '));
        const link = document.createElement('a');
        link.textContent = part;
        link.href = '#';
        link.onclick = async () => {
            currentPath = parts.slice(0, index + 1).join('/');
            await showFolder(owner, repo, currentPath, branch);
        }
        breadcrumb.appendChild(link);
    });
}

async function showFolder(owner, repo, path, branch) {
    const fileTree = document.getElementById('fileTree');
    fileTree.innerHTML = '';
    try {
        const contents = await fetchFolder(owner, repo, path, branch);
        contents.forEach(item => fileTree.appendChild(createFileLink(item, owner, repo, branch)));
        updateBreadcrumb(owner, repo, branch);
    } catch (e) {
        alert(e.message);
    }
}

async function loadRepo() {
    const repoInput = document.getElementById('repoInput').value.trim();
    const branch = document.getElementById('branchInput').value.trim() || 'main';
    const [owner, repo] = repoInput.split('/');
    if (!owner || !repo) return alert('Invalid repo format');
    currentPath = '';
    await showFolder(owner, repo, '', branch);
}
</script>
</body>
</html>
